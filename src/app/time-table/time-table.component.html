<div class="button-wrapper">
  <button mat-flat-button [disabled]="!allZones()" (click)="openDialog()">
    <span>Add timezone</span>
    <mat-icon *ngIf="!allZones()">
      <mat-spinner [diameter]="15"></mat-spinner>
    </mat-icon>
  </button>
</div>
<table mat-table [dataSource]="zoneState.value()!" class="mat-elevation-z8">
  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef> Name</th>
    <td mat-cell *matCellDef="let element"> {{ element.name }}</td>
  </ng-container>

  <ng-container matColumnDef="abbreviation">
    <th mat-header-cell *matHeaderCellDef> Abbreviation</th>
    <td mat-cell *matCellDef="let element"> {{ element.abbreviation }}</td>
  </ng-container>

  <ng-container matColumnDef="localTime">
    <th mat-header-cell *matHeaderCellDef> Local Time</th>
    <td mat-cell *matCellDef="let element"> @if (utcCounterInit(); as utcCounterCompute) {
      {{ utcCounterCompute | date: 'HH:mm:ss' : element.utcOffset}}
    } @else {
      <mat-spinner [diameter]="20"></mat-spinner>
    }</td>
  </ng-container>

  <ng-container matColumnDef="localDate">
    <th mat-header-cell *matHeaderCellDef> Local Date</th>
    <td mat-cell *matCellDef="let element"> {{ element.localDate }}</td>
  </ng-container>

  <ng-container matColumnDef="daylightSavingFlag">
    <th mat-header-cell *matHeaderCellDef> Has day light saving</th>
    <td mat-cell *matCellDef="let element">
      <mat-checkbox [checked]="element.dayLightSavingFlag" [disabled]="true"></mat-checkbox>
    </td>
  </ng-container>

  <ng-container matColumnDef="daylightSavingDates">
    <th mat-header-cell *matHeaderCellDef> Dates of daylight saving time</th>
    <td mat-cell *matCellDef="let element">
      @if (element.dayLightSavingFlag) {
        {{ element.daylightStartDate }} -> {{ element.daylightEndDate }}
      } @else {
        No data
      }
    </td>
  </ng-container>


  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>
@if (zoneLoad.isLoading() || zoneState.isLoading()) {
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
}
@if (zoneLoad.error()) {
  <span>An error occurs when trying to load a new zone {{ zoneLoad.error() }}</span>
}
@if (zoneState.error()) {
  <span>Error when initializing a component {{ zoneState.error() }}</span>
}

